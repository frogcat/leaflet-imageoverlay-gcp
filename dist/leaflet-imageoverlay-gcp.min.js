!function(){"use strict";var t,i=Math.pow(2,-52),r=new Uint32Array(512),e=function(t){var i=t.length>>1;if(i>0&&"number"!=typeof t[0])throw new Error("Expected coords to contain numbers.");this.coords=t;var r=Math.max(2*i-5,0);this._triangles=new Uint32Array(3*r),this._halfedges=new Int32Array(3*r),this._hashSize=Math.ceil(Math.sqrt(i)),this._hullPrev=new Uint32Array(i),this._hullNext=new Uint32Array(i),this._hullTri=new Uint32Array(i),this._hullHash=new Int32Array(this._hashSize).fill(-1),this._ids=new Uint32Array(i),this._dists=new Float64Array(i),this.update()};function a(t,i,r,e){var a=t-r,n=i-e;return a*a+n*n}function n(t,i,r,e,a,n){var s=(e-i)*(a-t),h=(r-t)*(n-i);return Math.abs(s-h)>=33306690738754716e-32*Math.abs(s+h)?s-h:0}function s(t,i,r,e,a,s){return(n(a,s,t,i,r,e)||n(t,i,r,e,a,s)||n(r,e,a,s,t,i))<0}function h(t,i,r,e,a,n){var s=r-t,h=e-i,o=a-t,l=n-i,_=s*s+h*h,v=o*o+l*l,u=.5/(s*l-h*o),c=(l*_-h*v)*u,d=(s*v-o*_)*u;return c*c+d*d}function o(t,i,r,e){if(e-r<=20)for(var a=r+1;a<=e;a++){for(var n=t[a],s=i[n],h=a-1;h>=r&&i[t[h]]>s;)t[h+1]=t[h--];t[h+1]=n}else{var _=r+1,v=e;l(t,r+e>>1,_),i[t[r]]>i[t[e]]&&l(t,r,e),i[t[_]]>i[t[e]]&&l(t,_,e),i[t[r]]>i[t[_]]&&l(t,r,_);for(var u=t[_],c=i[u];;){do{_++}while(i[t[_]]<c);do{v--}while(i[t[v]]>c);if(v<_)break;l(t,_,v)}t[r+1]=t[v],t[v]=u,e-_+1>=v-r?(o(t,i,_,e),o(t,i,r,v-1)):(o(t,i,r,v-1),o(t,i,_,e))}}function l(t,i,r){var e=t[i];t[i]=t[r],t[r]=e}function _(t){return t[0]}function v(t){return t[1]}e.from=function(t,i,r){void 0===i&&(i=_),void 0===r&&(r=v);for(var a=t.length,n=new Float64Array(2*a),s=0;s<a;s++){var h=t[s];n[2*s]=i(h),n[2*s+1]=r(h)}return new e(n)},e.prototype.update=function(){for(var t=this.coords,r=this._hullPrev,e=this._hullNext,n=this._hullTri,l=this._hullHash,_=t.length>>1,v=1/0,u=1/0,c=-1/0,d=-1/0,f=0;f<_;f++){var g=t[2*f],m=t[2*f+1];g<v&&(v=g),m<u&&(u=m),g>c&&(c=g),m>d&&(d=m),this._ids[f]=f}for(var p,y,T,w=(v+c)/2,E=(u+d)/2,A=1/0,x=0;x<_;x++){var P=a(w,E,t[2*x],t[2*x+1]);P<A&&(p=x,A=P)}var R=t[2*p],U=t[2*p+1];A=1/0;for(var I=0;I<_;I++)if(I!==p){var S=a(R,U,t[2*I],t[2*I+1]);S<A&&S>0&&(y=I,A=S)}for(var b=t[2*y],M=t[2*y+1],C=1/0,D=0;D<_;D++)if(D!==p&&D!==y){var L=h(R,U,b,M,t[2*D],t[2*D+1]);L<C&&(T=D,C=L)}var z=t[2*T],O=t[2*T+1];if(C===1/0){for(var F=0;F<_;F++)this._dists[F]=t[2*F]-t[0]||t[2*F+1]-t[1];o(this._ids,this._dists,0,_-1);for(var k=new Uint32Array(_),B=0,G=0,N=-1/0;G<_;G++){var X=this._ids[G];this._dists[X]>N&&(k[B++]=X,N=this._dists[X])}return this.hull=k.subarray(0,B),this.triangles=new Uint32Array(0),void(this.halfedges=new Uint32Array(0))}if(s(R,U,b,M,z,O)){var K=y,H=b,W=M;y=T,b=z,M=O,T=K,z=H,O=W}var q=function(t,i,r,e,a,n){var s=r-t,h=e-i,o=a-t,l=n-i,_=s*s+h*h,v=o*o+l*l,u=.5/(s*l-h*o);return{x:t+(l*_-h*v)*u,y:i+(s*v-o*_)*u}}(R,U,b,M,z,O);this._cx=q.x,this._cy=q.y;for(var Y=0;Y<_;Y++)this._dists[Y]=a(t[2*Y],t[2*Y+1],q.x,q.y);o(this._ids,this._dists,0,_-1),this._hullStart=p;var V=3;e[p]=r[T]=y,e[y]=r[p]=T,e[T]=r[y]=p,n[p]=0,n[y]=1,n[T]=2,l.fill(-1),l[this._hashKey(R,U)]=p,l[this._hashKey(b,M)]=y,l[this._hashKey(z,O)]=T,this.trianglesLen=0,this._addTriangle(p,y,T,-1,-1,-1);for(var j=0,J=void 0,Q=void 0;j<this._ids.length;j++){var Z=this._ids[j],$=t[2*Z],tt=t[2*Z+1];if(!(j>0&&Math.abs($-J)<=i&&Math.abs(tt-Q)<=i)&&(J=$,Q=tt,Z!==p&&Z!==y&&Z!==T)){for(var it=0,rt=0,et=this._hashKey($,tt);rt<this._hashSize&&(-1===(it=l[(et+rt)%this._hashSize])||it===e[it]);rt++);for(var at=it=r[it],nt=void 0;nt=e[at],!s($,tt,t[2*at],t[2*at+1],t[2*nt],t[2*nt+1]);)if((at=nt)===it){at=-1;break}if(-1!==at){var st=this._addTriangle(at,Z,e[at],-1,-1,n[at]);n[Z]=this._legalize(st+2),n[at]=st,V++;for(var ht=e[at];nt=e[ht],s($,tt,t[2*ht],t[2*ht+1],t[2*nt],t[2*nt+1]);)st=this._addTriangle(ht,Z,nt,n[Z],-1,n[ht]),n[Z]=this._legalize(st+2),e[ht]=ht,V--,ht=nt;if(at===it)for(;s($,tt,t[2*(nt=r[at])],t[2*nt+1],t[2*at],t[2*at+1]);)st=this._addTriangle(nt,Z,at,-1,n[at],n[nt]),this._legalize(st+2),n[nt]=st,e[at]=at,V--,at=nt;this._hullStart=r[Z]=at,e[at]=r[ht]=Z,e[Z]=ht,l[this._hashKey($,tt)]=Z,l[this._hashKey(t[2*at],t[2*at+1])]=at}}}this.hull=new Uint32Array(V);for(var ot=0,lt=this._hullStart;ot<V;ot++)this.hull[ot]=lt,lt=e[lt];this.triangles=this._triangles.subarray(0,this.trianglesLen),this.halfedges=this._halfedges.subarray(0,this.trianglesLen)},e.prototype._hashKey=function(t,i){return Math.floor((r=t-this._cx,e=i-this._cy,a=r/(Math.abs(r)+Math.abs(e)),(e>0?3-a:1+a)/4*this._hashSize))%this._hashSize;var r,e,a},e.prototype._legalize=function(t){for(var i,e,a,n,s,h,o,l,_,v,u,c,d,f,g,m,p=this._triangles,y=this._halfedges,T=this.coords,w=0,E=0;;){var A=y[t],x=t-t%3;if(E=x+(t+2)%3,-1!==A){var P=A-A%3,R=x+(t+1)%3,U=P+(A+2)%3,I=p[E],S=p[t],b=p[R],M=p[U];if(i=T[2*I],e=T[2*I+1],a=T[2*S],n=T[2*S+1],s=T[2*b],h=T[2*b+1],o=T[2*M],l=T[2*M+1],_=void 0,v=void 0,u=void 0,c=void 0,d=void 0,f=void 0,void 0,g=void 0,m=void 0,(_=i-o)*((c=n-l)*(m=(d=s-o)*d+(f=h-l)*f)-(g=(u=a-o)*u+c*c)*f)-(v=e-l)*(u*m-g*d)+(_*_+v*v)*(u*f-c*d)<0){p[t]=M,p[A]=I;var C=y[U];if(-1===C){var D=this._hullStart;do{if(this._hullTri[D]===U){this._hullTri[D]=t;break}D=this._hullPrev[D]}while(D!==this._hullStart)}this._link(t,C),this._link(A,y[E]),this._link(E,U);var L=P+(A+1)%3;w<r.length&&(r[w++]=L)}else{if(0===w)break;t=r[--w]}}else{if(0===w)break;t=r[--w]}}return E},e.prototype._link=function(t,i){this._halfedges[t]=i,-1!==i&&(this._halfedges[i]=t)},e.prototype._addTriangle=function(t,i,r,e,a,n){var s=this.trianglesLen;return this._triangles[s]=t,this._triangles[s+1]=i,this._triangles[s+2]=r,this._link(s,e),this._link(s+1,a),this._link(s+2,n),this.trianglesLen+=3,s},function(t){function i(t,i){for(var r=[],e=0;e<i.length;e+=3)for(var a=0;a<3;a++)r.push(t[a+0]*i[e+0]+t[a+3]*i[e+1]+t[a+6]*i[e+2]);return r}function r(t,i){return[t[0]-i[0],t[1]-i[1]]}function a(t,i){return t[0]*i[1]-t[1]*i[0]}var n=t.prototype.getContext;t.prototype.getContext=function(t,s){var h=this;if("morph"!==t)return n.apply(h,[t,s]);var o,l=h.getContext("webgl",{preserveDrawingBuffer:!0}),_=this.pg=l.createProgram();if(o=l.createShader(l.VERTEX_SHADER),l.shaderSource(o,"attribute vec4 p;varying vec2 a;uniform vec4 m;void main(){vec4 q=m*p;gl_Position=vec4(q.zw,0,1)+vec4(-1,1,0,0);a=q.xy;}"),l.compileShader(o),l.attachShader(_,o),function(t){l.shaderSource(t,"precision mediump float;uniform sampler2D i;varying vec2 a;void main(){gl_FragColor=texture2D(i,a);}"),l.compileShader(t),l.attachShader(_,t)}(l.createShader(l.FRAGMENT_SHADER)),l.linkProgram(_),!l.getProgramParameter(_,l.LINK_STATUS))throw new Error(l.getProgramInfoLog(_));l.useProgram(_);var v=null,u=null;return{_coords:null,canvas:h,drawImage:function(t,i){var r;v!==t&&((u=document.createElement("canvas")).width=Math.pow(2,Math.ceil(Math.log2(t.naturalWidth))),u.height=Math.pow(2,Math.ceil(Math.log2(t.naturalHeight))),u.getContext("2d").drawImage(t,0,0),r=l.createTexture(),l.bindTexture(l.TEXTURE_2D,r),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_S,l.CLAMP_TO_EDGE),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_T,l.CLAMP_TO_EDGE),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MIN_FILTER,l.NEAREST),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MAG_FILTER,l.NEAREST),l.texImage2D(l.TEXTURE_2D,0,l.RGBA,l.RGBA,l.UNSIGNED_BYTE,u),v=t);var a=[];e.from(i).triangles.forEach((function(t){Array.prototype.push.apply(a,i[t])})),this._coords=a,function(t){l.uniform4f(t,1/u.width,1/u.height,2/h.width,-2/h.height)}(l.getUniformLocation(_,"m"));var n=l.createBuffer();l.bindBuffer(l.ARRAY_BUFFER,n),l.bufferData(l.ARRAY_BUFFER,new Float32Array(a),l.STATIC_DRAW);var s=l.getAttribLocation(_,"p");l.enableVertexAttribArray(s),l.vertexAttribPointer(s,4,l.FLOAT,!1,0,0),l.drawArrays(l.TRIANGLES,0,a.length/4)},clear:function(){l.viewport(0,0,l.drawingBufferWidth,l.drawingBufferHeight),l.clearColor(0,0,0,0),l.clear(l.COLOR_BUFFER_BIT)},getTexturePointAt:function(t,e){for(var n,s,h,o,l,_,v,u,c,d,f,g,m,p,y,T,w=this._coords,E=0;E<w.length;E+=12){var A=[[w[E+2],w[E+3]],[w[E+6],w[E+7]],[w[E+10],w[E+11]]],x=[[w[E+0],w[E+1]],[w[E+4],w[E+5]],[w[E+8],w[E+9]]];if(_=[t,e],u=void 0,c=void 0,d=void 0,f=void 0,g=void 0,m=void 0,p=void 0,y=void 0,T=void 0,u=r((v=A)[1],v[0]),c=r(v[2],v[1]),d=r(v[0],v[2]),f=r(_,v[0]),g=r(_,v[1]),m=r(_,v[2]),p=a(u,g),y=a(c,m),T=a(d,f),p>0&&y>0&&T>0||p<0&&y<0&&T<0){var P=(s=x,h=void 0,o=void 0,l=void 0,l=[(n=A)[0][0],n[0][1],1,n[1][0],n[1][1],1,n[2][0],n[2][1],1],i([s[0][0],s[0][1],1,s[1][0],s[1][1],1,s[2][0],s[2][1],1],(o=(h=l)[0]*h[4]*h[8]+h[3]*h[7]*h[2]+h[6]*h[1]*h[5]-h[0]*h[7]*h[5]-h[6]*h[4]*h[2]-h[3]*h[1]*h[8],[(h[4]*h[8]-h[7]*h[5])/o,(h[7]*h[2]-h[1]*h[8])/o,(h[1]*h[5]-h[4]*h[2])/o,(h[6]*h[5]-h[3]*h[8])/o,(h[0]*h[8]-h[6]*h[2])/o,(h[3]*h[2]-h[0]*h[5])/o,(h[3]*h[7]-h[6]*h[4])/o,(h[6]*h[1]-h[0]*h[7])/o,(h[0]*h[4]-h[1]*h[3])/o]))),R=i(P,[t,e,1]);return[R[0],R[1]]}}return null}}}}(window.HTMLCanvasElement),(t=window.L).ImageOverlay.GCP=t.Layer.extend({options:{opacity:1,interactive:!0},initialize:function(i,r,e){this._url=i,this._groundControlPoints=r,t.Util.setOptions(this,e)},setOpacity:function(t){this.options.opacity=t,this._canvas&&this._updateOpacity()},_updateOpacity:function(){t.DomUtil.setOpacity(this._canvas,this.options.opacity)},setGroundControlPoints:function(t){this._groundControlPoints=t,this._canvas&&this._reset()},setUrl:function(t){this._url=t,this._canvas&&this._initImage()},_initImage:function(){if("IMG"===this._url.tagName)this._rawImage=this._url,this._url=this._rawImage.src,this._reset();else{var t=this;delete t._image;var i=new Image;i.crossOrigin="anonymous",i.onload=function(){t._rawImage=i,t._reset(),t.fire("load")},i.src=this._url}},getEvents:function(){return{zoom:this._reset,viewreset:this._reset,moveend:this._reset,resize:this._reset}},onAdd:function(i){this._canvas=document.createElement("canvas"),this._context=this._canvas.getContext("morph"),this._updateOpacity(),this.getPane().appendChild(this._canvas),this.options.interactive&&(t.DomUtil.addClass(this._canvas,"leaflet-interactive"),this.addInteractiveTarget(this._canvas)),this._initImage()},onRemove:function(i){t.DomUtil.remove(this._canvas),this.options.interactive&&this.removeInteractiveTarget(this._canvas)},_reset:function(){if(this._canvas&&this._rawImage){var i=this._map.getSize();this._canvas.width=i.x,this._canvas.height=i.y,this._canvas.style.width=i.x+"px",this._canvas.style.height=i.y+"px",t.DomUtil.setPosition(this._canvas,this._map.containerPointToLayerPoint([0,0])),this._context.clear(),this._context.drawImage(this._rawImage,this._groundControlPoints.map((function(t){var i=t.imagePoint,r=map.latLngToContainerPoint(t.latlng);return[i.x,i.y,r.x,r.y]})))}},containerPointToImagePoint:function(i){if(this._canvas&&this._rawImage){var r=this._context.getTexturePointAt(i.x,i.y);if(r)return t.point(r[0],r[1])}return null}}),t.imageOverlay.gcp=function(i,r,e){return new t.ImageOverlay.GCP(i,r,e)}}();
